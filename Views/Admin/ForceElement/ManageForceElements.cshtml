@model PaginatedList<SMARTV3.Models.ForceElement>

@using SMARTV3.Helpers
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer localizer

@{
    ViewData["Title"] = "ManageForceElements";
    Layout = "~/Views/Shared/_Layout.cshtml";
    CultureHelper cultureHelper = new CultureHelper();
    string lang = cultureHelper.GetCurrentCulture();
}

<form asp-action="ManageForceElements">
    <h4>@localizer["ManageForceElements"]</h4>

    <hr />
    <p>
        <a asp-action="AddForceElement"
           asp-route-pageNumber="@ViewData["pageNumber"]"
           asp-route-sortOrder="@ViewData["sortOrder"]"
           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
           asp-route-organizationFilter="@ViewData["organizationFilter"]"
           asp-route-ElementIdFilter="@ViewData["ElementIdFilter"]"
           asp-route-ElementNameFilter="@ViewData["ElementNameFilter"]"
           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]">
            <img src='@Url.Content("~/images/Add.png")' height="40" width="40" title="@localizer["AddForceElement"]" />
        </a>
    </p>

    <h5>@localizer["FilterForceElements"]</h5>
    <hr />

    <div class="row">
        <div class="col">
            <label>@localizer["Organizations"]</label>
            @Html.DropDownList("OrganizationFilter", ViewBag.OrganizationId, "", new { @class = "form-select", style="display: block;"})
        </div>
        <div class="col">
            <label>@localizer["ElementName"]</label>
            @Html.TextBox("ElementNameFilter","","", new { @class = "form-control", style="display: block;"})
        </div>
        <div class="col">
            <label>@localizer["ElementId"]</label>
            @Html.TextBox("ElementIdFilter","","", new { @class = "form-control", style="display: block;"})
        </div>
    </div><br />
    <div class="row">
        <div class="col">
            <div class="form-group form-check">
                <label class="form-check-label">
                    @Html.CheckBox("ShowDisabledFelms") @localizer["ShowDisabledForceElements"]
                </label>
            </div>
        </div>
        <div class="col">
            <div class="form-group form-check">
                <label class="form-check-label">
                    @Html.CheckBox("ShowAspirationalFelms") @localizer["ShowAspirationalFelms"]
                </label>
            </div>
        </div>
        <div class="col">
            <button type="submit" style="border: 0; background: transparent">
                <img src='@Url.Content("~/images/More.png")' height="20" width="20" title="@localizer["Filter"]" />
            </button>
            <a asp-action="ManageForceElements"
               asp-route-selectedPageSize="@ViewData["selectedPageSize"]">
                <img src='@Url.Content("~/images/Cancel.png")' height="20" width="20" title="@localizer["Clear"]" />
            </a>
        </div>
    </div>
    <br />
    <h5>@localizer["ForceElements"]</h5>
    <hr />

    <table class="table">
        <thead>
            <tr>
                <th>
                    @localizer["ElementId"]
                    <div class="sort-div">
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="elemId_asc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-up.svg" alt="@localizer["SortAscending"]" />
                        </a>
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="elemId_desc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-down.svg" alt="@localizer["SortDescending"]" />
                        </a>
                    </div>
                </th>
                <th>
                    @localizer["ElementName"]
                    <div class="sort-div">
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="elemName_asc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-up.svg" alt="@localizer["SortAscending"]" />
                        </a>
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="elemName_desc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-down.svg" alt="@localizer["SortDescending"]" />
                        </a>
                    </div>
                </th>
                <th>
                    @localizer["ElementNameFre"]
                    <div class="sort-div">
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="elemNameFr_asc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-up.svg" alt="@localizer["SortAscending"]" />
                        </a>
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="elemNameFr_desc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-down.svg" alt="@localizer["SortDescending"]" />
                        </a>
                    </div>
                </th>
                <th>
                    @localizer["OrganizationForceGenerator"]
                    <div class="sort-div">
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="orgFG_asc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-up.svg" alt="@localizer["SortAscending"]" />
                        </a>
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="orgFG_desc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-down.svg" alt="@localizer["SortDescending"]" />
                        </a>
                    </div>
                </th>
                <th>
                    @localizer["Weighting"]
                    <div class="sort-div">
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="weight_asc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-up.svg" alt="@localizer["SortAscending"]" />
                        </a>
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="weight_desc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-down.svg" alt="@localizer["SortDescending"]" />
                        </a>
                    </div>
                </th>
                <th>
                    @localizer["NTM"]
                    <div class="sort-div">
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="ntm_asc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-up.svg" alt="@localizer["SortAscending"]" />
                        </a>
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="ntm_desc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-down.svg" alt="@localizer["SortDescending"]" />
                        </a>
                    </div>
                </th>
                <th>
                    @localizer["AspirationalForceElement"]
                </th>
                <th>
                    @localizer["SortOrder"]
                    <div class="sort-div">
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="sortOrder_asc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-up.svg" alt="@localizer["SortAscending"]" />
                        </a>
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="sortOrder_desc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-down.svg" alt="@localizer["SortDescending"]" />
                        </a>
                    </div>
                </th>
                <th>
                    @localizer["Archived"]
                </th>
                <th>
                    @localizer["ArchiveComments"]
                </th>
                <th>
                    @localizer["CommentDate"]
                    <div class="sort-div">
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="commDate_asc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-up.svg" alt="@localizer["SortAscending"]" />
                        </a>
                        <a asp-action="ManageForceElements"
                           asp-route-sortOrder="commDate_desc"
                           asp-route-pageNumber="@Model.PageIndex"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
                           asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
                           class="sort-button">
                            <img src="~/images/sort-down.svg" alt="@localizer["SortDescending"]" />
                        </a>
                    </div>
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                ForceElementArchiveComment? newestComment = item.ForceElementArchiveComments.LastOrDefault();
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.ElementId)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ElementName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ElementNameFre)
                    </td>
                    <td>
                        @if (lang == "en")
                        {
                            @Html.DisplayFor(modelItem => item.Organization.OrganizationName)
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.Organization.OrganizationNameFre)
                        }
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Weighting!.WeightValue)
                    </td>
                    <td>
                        @if (lang == "en")
                        {
                            @Html.DisplayFor(modelItem => item.DataCards.FirstOrDefault().NoticeToMove.NoticeToMoveName)
                        }
                        else
                        {
                            @Html.DisplayFor(modelItem => item.DataCards.FirstOrDefault().NoticeToMove.NoticeToMoveNameFre)
                        }
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Aspirational)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Ordered)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Archived)
                    </td>
                    @if (newestComment != null)
                    {
                        <td>
                            <label class="comment-scroll">@newestComment.ArchiveComment.Comments</label>
                        </td>
                        <td>
                            <label>@newestComment.ArchiveComment.ChangeDate.ToString("g")</label>
                        </td>
                    }
                    else
                    {
                        <td></td>
                        <td></td>
                    }
                    <td>
                        <a asp-action="EditForceElement"
                           asp-route-id="@item.Id"
                           asp-route-sortOrder="@ViewData["sortOrder"]"
                           asp-route-pageNumber="@ViewData["pageNumber"]"
                           asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
                           asp-route-organizationFilter="@ViewData["organizationFilter"]"
                           asp-route-ElementIdFilter="@ViewData["ElementIdFilter"]"
                           asp-route-ElementNameFilter="@ViewData["ElementNameFilter"]"
                           asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
                           asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]">
                            <img src='@Url.Content("~/images/Edit.png")' height="20" width="20" title="@localizer["Edit"]" />
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    @{
        var prevDisabled = !Model.HasPreviousPage ? "disabled" : "";
        var nextDisabled = !Model.HasNextPage ? "disabled" : "";
    }

    <a asp-action="ManageForceElements"
       asp-route-pageNumber="@(Model.PageIndex - 1)"
       asp-route-sortOrder="@ViewData["sortOrder"]"
       asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
       asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
       asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
       asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
       asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
       asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
       class="btn btn-default @prevDisabled">
        @localizer["Previous"]
    </a>
    @{
        int currentPage = Model.PageIndex;
        int i = currentPage;
        int lastVisiblePage = currentPage + 3;
        int totalPages = Model.TotalPages;
        bool moreThanMaxPages = false;

        if (lastVisiblePage > totalPages)
        {
            lastVisiblePage = totalPages;
        }
        else if (totalPages > lastVisiblePage)
        {
            moreThanMaxPages = true;
        }
        if (i > 1)
        {
            <a asp-action="ManageForceElements"
               asp-route-pageNumber="1"
               asp-route-sortOrder="@ViewData["sortOrder"]"
               asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
               asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
               asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
               asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
               asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
               asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
               class="btn btn-default">
                1
            </a>
        }
        if (currentPage > 2)
        {
            <label>...</label>
        }
        while (i <= lastVisiblePage)
        {
            <a asp-action="ManageForceElements"
               asp-route-pageNumber="@i"
               asp-route-sortOrder="@ViewData["sortOrder"]"
               asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
               asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
               asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
               asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
               asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
               asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
               class="btn btn-default">
                @if (i == currentPage)
                {
                    <b>@i</b>
                }
                else
                {
                    @i
                }
            </a>
            i++;
        }
        if (moreThanMaxPages)
        {
            <label>...</label>
        }
    }
    <a asp-action="ManageForceElements"
       asp-route-pageNumber="@(Model.PageIndex + 1)"
       asp-route-sortOrder="@ViewData["sortOrder"]"
       asp-route-selectedPageSize="@ViewData["selectedPageSize"]"
       asp-route-organizationFilter="@ViewData["OrganizationFilter"]"
       asp-route-elementIdFilter="@ViewData["ElementIdFilter"]"
       asp-route-elementNameFilter="@ViewData["ElementNameFilter"]"
       asp-route-ShowDisabledFelms="@ViewData["ShowDisabledFelms"]"
       asp-route-ShowAspirationalFelms="@ViewData["ShowAspirationalFelms"]"
       class="btn btn-default @nextDisabled">
        @localizer["Next"]
    </a>
    <div style="display: inline-block; padding-right: 2rem;">
        @Html.DropDownList("selectedPageSize", ViewBag.itemsPerPage, null, new { @onchange="form.submit();" })
    </div>
</form>
